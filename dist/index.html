<!doctype html>
<html lang="en" ng-app="AnnotatedTutorial">
  <head>
    <meta charset="UTF-8">
    <title>Annotated Tutorial</title>
    <meta name="viewport" content="width=device-width, user-scalable=no" />

    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.css" src="css/">
    <link rel="stylesheet" href="/angular-ui-select/dist/select.css">
    <link href="http://http://fonts.googleapis.com/css?family=Open+Sans'rel='stylesheet'type='text/css'">
      <link rel="stylesheet" href="css/main.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="scripts/smooth-scrolling.js"></script>
    <script src="scripts/modernizr.js"></script>
  </head>
  <div ng-controller="mainController">
    <div class="l-wrap">
      <div class="grid grid--full is-extended">
          <div class="grid__item three-quarters is-extended content">
            <div class="l-block grid grid--full">
                <div class="grid__item one-tenth is-right-aligned"></div>

                <!--
              --> <div class="grid__item six-eighths">
                    <div id="general"></div>
                    <h1 class="tutorial-title">{{tutorial.title}}</h1>
                    <h3 class="tutorial-author">by {{tutorial.author}}</h3>
                <!-- Buttons to toggle the list of authors-->
                <div ng-click="contributorFlag = showContributors(contributorFlag)">
                        <div class="contributors-show" ng-show="!contributorFlag" tooltip="Show"></div>
                        <div class="contributors-hide" ng-show="contributorFlag" tooltip="Hide"></div>
                </div>
                <div class="contributor-button"
                     ng-click="contributorFlag=showContributors(contributorFlag)">{{listOfContributors.length.toString()}} Other contributors
                 </div>
                 <div ng-show="contributorFlag">
                    <div ng-repeat="contributor in listOfContributors">
                         <div class="contributor-first" ng-if="contributor == listOfContributors[0]">{{contributor}},</div>
                         <div class="contributor" ng-if="contributor!=listOfContributors[0] && contributor!=listOfContributors[listOfContributors.length-1]">{{contributor}},</div>
                         <div class="contributor" ng-if="contributor!=listOfContributors[0] && contributor===listOfContributors[listOfContributors.length-1]">{{contributor}}</div>
                    </div>
                 </div>
            </div>
           </div>

          <div class="l-block grid grid--full"
               ng-repeat="step in listOfSteps"
               ng-mouseenter="hover = true"
               ng-mouseleave="hover = false"
               ng-if="step.step_number<listOfSteps.length-1"
               ng-class="{'selected-step':selectedStepsList.indexOf(step)!=-1 || noteStepList.indexOf(step.id)!=-1}">
              
              <div class="grid__item one-tenth input-start-container is-center-aligned">
                  <!--<button class="input-start icon" ng-if="inputPos === null" ng-show="hover && selectedLine != $index" ng-click="resetCurrent();lineClicked($index, $event,step);stepSelected(step);numberList()" tooltip="Add a note"></button>-->
              </div>
              <!-- Buttons to toggle on/off notes -->
              <div class="grid__item six-eighths">
                  <div id="{{step.id}}">
                      <h2 ng-if="!(step.step_number==0) && (step.step_number<(tutorial.steps.length-2))">Step {{step.step_number}}</h2>
                  </div>
                  <div id="{{tutorial.steps[tutorial.steps.length-2].id}}" ng-if="(step.step_number==(tutorial.steps.length-2))"></div>
                  <div class="main-content" ng-bind-html="step.html"></div>
              </div><!--

                --><div class="grid__item one-twelfth is-left-aligned" >

              <div class="grid__item one-tenth input-start-container">
                  <!-- Button for adding a note -->
                  <button class="input-start icon" ng-click="resetCurrent();lineClicked($index, $event,step);stepSelected(step);numberList()" ng-show="(hover && currentStep.length == 0)|| currentStep[0] == step" tooltip="Add a note"></button>
              </div>

              <button class="icon icon-corrections icon-bar"
                      ng-if="checkForCategory(step, 'corrections')"
                      ng-click="sideIcon(step,'corrections')"
                      ng-class="{'selected selected-corrections': categoryFilter == 'corrections' && stepFilter[0] == step.step_number}"
                      tooltip="Corrections">
                  <div class = "icon__number number-corrections">{{numberOfNotes(step,"corrections")}}</div>
              </button>

              <button class="icon icon-details icon-bar"
                      ng-if="checkForCategory(step, 'details')"
                      ng-click="sideIcon(step, 'details')"
                      ng-class="{'selected selected-details': categoryFilter == 'details' && stepFilter[0] == step.step_number}"
                      tooltip="Tell me more!">
                  <div class="icon__number number-details">{{numberOfNotes(step,"details")}}</div>
              </button>

              <button class="icon icon-questions icon-bar"
                      ng-if="checkForCategory(step, 'questions')"
                      ng-click="sideIcon(step, 'questions')"
                      ng-class="{'selected selected-questions': categoryFilter == 'questions' && stepFilter[0] == step.step_number}"
                      tooltip="Questions">
                  <div class="icon__number number-questions">{{numberOfNotes(step,"questions")}}</div>
              </button>

              <button class="icon icon-other icon-bar"
                      ng-if="checkForCategory(step, 'other')"
                      ng-click="sideIcon(step, 'other')"
                      ng-class="{'selected selected-other': categoryFilter == 'other' && stepFilter[0] == step.step_number}"
                      tooltip="Other">
                  <div class="icon__number number-other">{{numberOfNotes(step,"other")}}</div>
              </button>

          </div></div><!--

           --><div>
                  <div ng-if="tutorial.notes" class="three-tenths">
                      <div class="grid__item three-tenths filter-container filter" ng-class="{'filter-open-container': menuOpen || replyTo !== null}">
                          <div class="note-display" style="margin-left:3%;">Sort</div>
                          <div class="note-display">Filter</div>
                          <div class="note-display filter-steps">Steps</div>
                          <button class="clear-button prime-text" ng-click=" clear();">CLEAR</button><br>
                          <div style="width:29.3%;height:6%;position:fixed;margin-top:10px">
                              <select style="width:23%; float:left;margin-left:2%;margin-right:7.4%" class="form-control sortDropdown" id="sort" ng-click="$parent.sortSelected()">
                                  <option value="new" selected>Recent</option>
                                  <option value="old">Oldest</option>
                                  <option value="high">Rate:High</option>
                                  <option value="low">Rate:Low</option>
                                  <option value="category">Category</option>
                              </select>

                              <button class="filter-icon filter-icon-corrections" ng-class="{'selected selected-corrections': categoryFilter == 'corrections'}" ng-click="newFilter('corrections')" tooltip="Corrections"></button>
                              <button class="filter-icon filter-icon-details" ng-class="{'selected selected-details': categoryFilter == 'details'}"  ng-click="newFilter('details')" tooltip="Tell me more!"></button>
                              <button class="filter-icon filter-icon-questions" ng-class="{'selected selected-questions': categoryFilter == 'questions'}"  ng-click="newFilter('questions')" tooltip="Questions"></button>
                              <button class="filter-icon filter-icon-other" ng-class="{'selected selected-other': categoryFilter == 'other'}"  ng-click="newFilter('other')" tooltip="Other"></button>
                              <div>
                                  <ui-select on-select="newFilter($item.id)" ng-model="item.selected" placeholder="Select a step" on-remove="newFilter($item.id)" multiple limit="4" close-on-select="false" style="width:34.5%;margin:0 0 !Important;" theme="bootstrap" append-to-body="true">
                                      <ui-select-match placeholder="Select a step">
                                          <span style="height:20%;" ng-bind="$item.name"></span>
                                      </ui-select-match>
                                      <ui-select-choices repeat="item in itemArray | filter: $select.search track by item.id">
                                          <div  ng-bind="item.name"></div>
                                      </ui-select-choices>
                                      <ui-select-no-choice>
                                          No results
                                      </ui-select-no-choice>
                                  </ui-select>
                              </div>
                          </div>
                      </div>

                      <div class="grid__item three-tenths note-container" ng-class="{'note-open-container':menuOpen || replyTo !== null}">
                      <note ng-repeat="note in listOfNotes"
                            ng-if="canShowNote(note) && note.reply_to == null"
                            note="note"
                            delete-it="deleteNote"
                            rate-it="newRating"
                            add-reply="addingReply"
                            can-show-note="canShowNote"
                            show-list="showStepList"
                            user="contributor"
                            general="note.step_id[0] === listOfSteps[listOfSteps.length-1].id"
                            date="dateFormat(note)"
                            current-note="note === currentNote"
                            notelist="getNoteList(note)"
                            current-reply="replyTo"
                            reply-one="true">
                      </note>
                      </div>
                  </div>
          </div>
          <div class="input-container" ng-if="inputPos != null" ng-style="{'top':2.2 + '%', 'right':1.1 + '%'}" style="height:32%;width:29.95%;padding: 5px;">
              <div class ="window-title" ng-if="replyTo != null">Replying to {{$parent.replyToContributor}}: "{{(tutorial.notes[findNoteIndex(replyTo)].content.substring(0,50))}}..."</div>
              <div ng-if="replyTo==null">
                <div ng-if="!secondMenu">
                    <div class="window-title" >Select the steps you want to comment on</div>
                    <div ng-repeat="step in currentStep">
                        <a class="close-button" ng-click="closeInput()" href="#{{step.id}}">X</a>
                        <a class="return-button-first return-button prime-text" href="#{{step.id}}">VIEW ORIGINAL STEP</a>
                    </div>
                    <div class="selected-steps" ng-if="selectedStepsList.length == 0">None Selected</div>
                    <div>
                        <div class="selected-steps" ng-if="selectedStepsList.length !=0">Step(s): {{list.toString()}}</div>
                        <button class="menu-button menu-one" ng-click="menuSwitch()" ng-show="true" tooltip="Next"></button>
                    </div>
                    <br>
                    <div>
                          <a class="menu-action-button preview-button" ng-click="loggerMethod('general');" href="#general" tooltip="Preview"></a>
                          <button class="menu-action-button" ng-click="chosenGeneral(listOfSteps[listOfSteps.length-1]);numberList();" ng-class="{'selected-menu-button':general}">
                              <div class="plus-action-button prime-text" ng-if="!general">+</div>
                              <div class="minus-action-button" ng-if="general">-</div>
                          </button>
                          <div style="margin-top:2%" class="step-list prime-text" ng-class="{'selected-menu-button':general}" ng-click="chosenGeneral(listOfSteps[listOfSteps.length-1]);numberList();">GENERAL</div>
                          <div ng-repeat="step in listOfSteps" ng-if="step.step_number <listOfSteps.length-1">
                              <a class="menu-action-button preview-button" ng-click="loggerMethod(step.step_number);" href="#{{step.id}}" ng-class="{'disabled-eye':general}" tooltip="Preview"></a>
                              <button class="menu-action-button" id="step {{step.step_number}}" ng-click="stepSelected(step);numberList()" ng-class="{'selected-menu-button':selectedStepsList.indexOf(step)!=-1}">
                                  <div class="plus-action-button prime-text" ng-class="{'disabled-steps':general}" ng-if="selectedStepsList.indexOf(step)==-1">+</div>
                                  <div class="minus-action-button" ng-class="{'disabledSteps':general}" ng-if="selectedStepsList.indexOf(step)!=-1">-</div>
                               </button>
                            <div class="step-list prime-text" ng-if="step.step_number==0" ng-class="{'disabled-steps':general,'selected-menu-button':selectedStepsList.indexOf(step)!=-1}"  ng-click="stepSelected(step);numberList()">INTRO</div>
                            <div class="step-list prime-text" ng-if="step.step_number==listOfSteps.length-2" ng-class="{'disabled-steps':general,'selected-menu-button':selectedStepsList.indexOf(step)!=-1}"  ng-click="stepSelected(step);numberList()">END</div>
                            <div class="step-list prime-text" ng-if="step.step_number!=0 && step.step_number <listOfSteps.length-2" ng-class="{'disabled-steps':general,'selected-menu-button':selectedStepsList.indexOf(step)!=-1}"  ng-click="stepSelected(step);numberList()">STEP {{step.step_number}}</div>
                          </div>
                    </div>
                </div>

                <div ng-if="secondMenu">
                   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

                   <div class="window-title categories-title">Note Categories</div>
                    <div class="window-title">Commenting on</div>


                   <div ng-repeat="step in currentStep">
                      <a class="return-button-second return-button prime-text" href="#{{step.id}}">VIEW ORIGINAL STEP</a>
                      <a class="close-button close-button-second" ng-click="closeInput()" href="#{{step.id}}">X</a>
                   </div>
                    <button class="menu-two menu-button" style="margin-left:1% "ng-click="menuSwitch()" tooltip="Back"></button>
                     <button style="float:left; margin-right:1%;" ng-click="categorySelected('corrections')" class="icon filter-icon-corrections icon-corrections" ng-class="{'selected selected-corrections': inputCategory == 'corrections'}" tooltip="Corrections"></button>
                     <button style="float:left; margin-right:1%;" ng-click="categorySelected('details')" class="icon icon-details filter-icon-details" ng-class="{'selected selected-details': inputCategory == 'details'}" tooltip="Tell me more!"></button>
                     <button style="float:left; margin-right:1%;" ng-click="categorySelected('questions')" class="icon icon-questions filter-icon-questions" ng-class="{'selected selected-questions': inputCategory == 'questions'}" tooltip="Questions"></button>
                     <button style="float:left ;margin-right:5.5%" ng-click="categorySelected('other')" class="icon icon-other filter-icon-other" ng-class="{'selected selected-other': inputCategory == 'other'}" tooltip="Other notes"></button>
                     <div style="margin-bottom:2%">
                        <div ng-if="selectedStepsList.length !=0">{{list.toString()}}</div>
                        <div ng-if="selectedStepsList.length == 0">None Selected</div>
                     </div>
                     <div style="margin-left:5%" ng-if="inputCategory==''">Please select a note category</div>
                </div>
              </div>

              <div ng-show="((showTextarea && secondMenu) || replyTo!==null)">
                <div class="description"  ng-if="replyTo==null">
                  <div ng-if="inputCategory == 'corrections'">Found a mistake? Help us out by pointing it out!</div>
                  <div ng-if="inputCategory == 'details'">Useful information that may help others understand and learn from the tutorial.</div>
                  <div ng-if="inputCategory == 'questions'">Need help with the tutorial? Ask a question for others to answer.</div>
                  <div ng-if="inputCategory == 'other'">Have a note that doesn't fit in the other categories? Use this one!</div>
                </div>
                <div class="software-container" ng-if="(inputCategory == 'other') && replyTo==null">
                  <div ng-if="inputCategory == 'other'">How would you label your note?</div>
                  <input class ="input-text" type="text" ng-model="$parent.$parent.extraInput"/>
                </div>
                <div ng-if="replyTo!=null">
                      <div class="close-button reply-close" ng-click="closeInput()">X</div>
                      <br>
                </div>
                <textarea class="input-text" ng-model="$parent.newNote" rows="5" placeholder="Please enter your note here."></textarea>
                <button ng-click="submitNote()" class="plain-button prime-background submit-button">SUBMIT</button>
              </div>
          </div>
          </div>
      </div>
    </div>
    </div>


    <script src="scripts/dependencies.js"></script>

    <script src="scripts/templates.js"></script>

    <script src="scripts/app.js"></script>
  </body>
</html>